<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A member of a networking protocol stack."><meta name="keywords" content="rust, rustlang, rust-lang, Protocol"><title>Protocol in elvis::core - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../elvis/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../elvis/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Protocol</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><ul><li><a href="#tymethod.demux">demux</a></li><li><a href="#tymethod.id">id</a></li><li><a href="#tymethod.listen">listen</a></li><li><a href="#tymethod.open">open</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#provided-methods">Provided Methods</a></h3><ul><li><a href="#method.start">start</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div></section><h2 class="location"><a href="index.html">In elvis::core</a></h2><div id="sidebar-vars" data-name="Protocol" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../elvis/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Trait <a href="../index.html">elvis</a>::<wbr><a href="index.html">core</a>::<wbr><a class="trait" href="#">Protocol</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/elvis/core/protocol.rs.html#48-133">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub trait Protocol {
    fn <a href="#tymethod.id" class="fnname">id</a>(&amp;self) -&gt; <a class="struct" href="struct.ProtocolId.html" title="struct elvis::core::ProtocolId">ProtocolId</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.open" class="fnname">open</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upstream: <a class="struct" href="struct.ProtocolId.html" title="struct elvis::core::ProtocolId">ProtocolId</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;participants: <a class="struct" href="control/struct.Control.html" title="struct elvis::core::control::Control">Control</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context: &amp;mut <a class="struct" href="struct.ProtocolContext.html" title="struct elvis::core::ProtocolContext">ProtocolContext</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.62.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.SharedSession.html" title="struct elvis::core::SharedSession">SharedSession</a>, <a class="struct" href="https://doc.rust-lang.org/1.62.1/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.62.1/std/error/trait.Error.html" title="trait std::error::Error">Error</a>&gt;&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.listen" class="fnname">listen</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upstream: <a class="struct" href="struct.ProtocolId.html" title="struct elvis::core::ProtocolId">ProtocolId</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;participants: <a class="struct" href="control/struct.Control.html" title="struct elvis::core::control::Control">Control</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context: &amp;mut <a class="struct" href="struct.ProtocolContext.html" title="struct elvis::core::ProtocolContext">ProtocolContext</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.62.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>, <a class="struct" href="https://doc.rust-lang.org/1.62.1/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.62.1/std/error/trait.Error.html" title="trait std::error::Error">Error</a>&gt;&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.demux" class="fnname">demux</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message: <a class="struct" href="message/struct.Message.html" title="struct elvis::core::message::Message">Message</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context: &amp;mut <a class="struct" href="struct.ProtocolContext.html" title="struct elvis::core::ProtocolContext">ProtocolContext</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.62.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>, <a class="struct" href="https://doc.rust-lang.org/1.62.1/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.62.1/std/error/trait.Error.html" title="trait std::error::Error">Error</a>&gt;&gt;;

    fn <a href="#method.start" class="fnname">start</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_context: <a class="struct" href="struct.ProtocolContext.html" title="struct elvis::core::ProtocolContext">ProtocolContext</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_shutdown: <a class="struct" href="../../tokio/sync/mpsc/bounded/struct.Sender.html" title="struct tokio::sync::mpsc::bounded::Sender">Sender</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.62.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>, <a class="struct" href="https://doc.rust-lang.org/1.62.1/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.62.1/std/error/trait.Error.html" title="trait std::error::Error">Error</a>&gt;&gt; { ... }
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A member of a networking protocol stack.</p>
<p>A protocol is responsible for creating new <a href="trait.Session.html"><code>Session</code></a>s and
demultiplexing requests to the correct session.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.id" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/elvis/core/protocol.rs.html#54">source</a></div><h4 class="code-header">fn <a href="#tymethod.id" class="fnname">id</a>(&amp;self) -&gt; <a class="struct" href="struct.ProtocolId.html" title="struct elvis::core::ProtocolId">ProtocolId</a></h4></div></summary><div class="docblock"><p>Returns a unique identifier for the protocol.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.open" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/elvis/core/protocol.rs.html#70-75">source</a></div><h4 class="code-header">fn <a href="#tymethod.open" class="fnname">open</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;upstream: <a class="struct" href="struct.ProtocolId.html" title="struct elvis::core::ProtocolId">ProtocolId</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;participants: <a class="struct" href="control/struct.Control.html" title="struct elvis::core::control::Control">Control</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;context: &amp;mut <a class="struct" href="struct.ProtocolContext.html" title="struct elvis::core::ProtocolContext">ProtocolContext</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.62.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.SharedSession.html" title="struct elvis::core::SharedSession">SharedSession</a>, <a class="struct" href="https://doc.rust-lang.org/1.62.1/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.62.1/std/error/trait.Error.html" title="trait std::error::Error">Error</a>&gt;&gt;</h4></div></summary><div class="docblock"><p>Actively open a new network connection.</p>
<p>Called by the <code>upstream</code> protocol to create a new
<a href="trait.Session.html"><code>Session</code></a> for a connection. Each protocol should, in
turn, <code>open</code> a session with some downstream protocol to establish a
chain of sessions with which to send and receive messages for the
requesting user program.</p>
<p>The <code>participants</code> set contains key-value pairs that identify aspects of
a connection to facilitate <a href="trait.Protocol.html#tymethod.demux"><code>demux</code></a>ing. It should
contain all attributes needed to uniquely identify the connection. For
example, an IP protocol might require the attributes <code>{local_address, remote_address}</code>. A UDP or TCP protocol might require the attributes
<code>{local_address, local_port, remote_address, remote_port}</code>.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.listen" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/elvis/core/protocol.rs.html#92-97">source</a></div><h4 class="code-header">fn <a href="#tymethod.listen" class="fnname">listen</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;upstream: <a class="struct" href="struct.ProtocolId.html" title="struct elvis::core::ProtocolId">ProtocolId</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;participants: <a class="struct" href="control/struct.Control.html" title="struct elvis::core::control::Control">Control</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;context: &amp;mut <a class="struct" href="struct.ProtocolContext.html" title="struct elvis::core::ProtocolContext">ProtocolContext</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.62.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>, <a class="struct" href="https://doc.rust-lang.org/1.62.1/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.62.1/std/error/trait.Error.html" title="trait std::error::Error">Error</a>&gt;&gt;</h4></div></summary><div class="docblock"><p>Listen for new connections.</p>
<p>Requests that messages for which there is no existing session be sent to
the <code>upstream</code> protocol. Only messages that match the <code>participants</code> set
will be forwarded. See <a href="trait.Protocol.html#tymethod.demux"><code>demux</code></a> for more details.</p>
<p>The participants set should contain all attributes needed to identify
the listening program. For example, an IP protocol might use the set of
attributes <code>{local_address}</code>. Since we are listening for connections
from any remote address, when the IP protocol sees a message it does not
have a session for, it will check whether the local address given in the
header is one it is listening for. If so, it will create the session
identified by <code>{local_address, remote_address}</code> and continue
demultiplexing the message. Similarly, a UDP or TCP protocol would want
its participant set to include {local_address, local_port}.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.demux" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/elvis/core/protocol.rs.html#117-121">source</a></div><h4 class="code-header">fn <a href="#tymethod.demux" class="fnname">demux</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;message: <a class="struct" href="message/struct.Message.html" title="struct elvis::core::message::Message">Message</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;context: &amp;mut <a class="struct" href="struct.ProtocolContext.html" title="struct elvis::core::ProtocolContext">ProtocolContext</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.62.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>, <a class="struct" href="https://doc.rust-lang.org/1.62.1/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.62.1/std/error/trait.Error.html" title="trait std::error::Error">Error</a>&gt;&gt;</h4></div></summary><div class="docblock"><p>Identifies the session that a message belongs to and forwards the
message to it.</p>
<p>When demultiplexing a message, a protocol will typically carry out
several tasks:</p>
<ul>
<li>Remove and parse the message header.</li>
<li>Apply information about the message header to the context. This should
include any information that the target session or other protocols may
need to know about. For example, an IP protocol should add the source
and destination addresses to the context so that UDP and TCP may use
them for verifying checksums.</li>
<li>Select a session to respond to the message. This is done by looking at
information extracted from the header. If there is no matching
session, the protocol should check to see whether any protocol has
asked to receive the message by calling <a href="trait.Protocol.html#tymethod.listen"><code>listen</code></a>
at an earlier time. If so, a new session should be created.</li>
<li>Call <a href="trait.Session.html#tymethod.receive"><code>receive</code></a> on the selected session.</li>
</ul>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="method.start" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/elvis/core/protocol.rs.html#126-132">source</a></div><h4 class="code-header">fn <a href="#method.start" class="fnname">start</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;_context: <a class="struct" href="struct.ProtocolContext.html" title="struct elvis::core::ProtocolContext">ProtocolContext</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;_shutdown: <a class="struct" href="../../tokio/sync/mpsc/bounded/struct.Sender.html" title="struct tokio::sync::mpsc::bounded::Sender">Sender</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>&gt;<br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.62.1/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>, <a class="struct" href="https://doc.rust-lang.org/1.62.1/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.62.1/std/error/trait.Error.html" title="trait std::error::Error">Error</a>&gt;&gt;</h4></div></summary><div class="docblock"><p>Start the protocol running. This may spawn tasks and timers
that the protocol needs to run.
The default implementation is a no-op.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"><section id="impl-Protocol" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/elvis/protocols/ipv4/mod.rs.html#51-136">source</a></span><a href="#impl-Protocol" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="trait.Protocol.html" title="trait elvis::core::Protocol">Protocol</a> for <a class="struct" href="../protocols/ipv4/struct.Ipv4.html" title="struct elvis::protocols::ipv4::Ipv4">Ipv4</a></h3></section><section id="impl-Protocol-1" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/elvis/protocols/tap/mod.rs.html#74-174">source</a></span><a href="#impl-Protocol-1" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="trait.Protocol.html" title="trait elvis::core::Protocol">Protocol</a> for <a class="struct" href="../protocols/tap/struct.Tap.html" title="struct elvis::protocols::tap::Tap">Tap</a></h3></section><section id="impl-Protocol-2" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/elvis/protocols/udp/mod.rs.html#47-154">source</a></span><a href="#impl-Protocol-2" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="trait.Protocol.html" title="trait elvis::core::Protocol">Protocol</a> for <a class="struct" href="../protocols/udp/struct.Udp.html" title="struct elvis::protocols::udp::Udp">Udp</a></h3></section><section id="impl-Protocol-3" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/elvis/protocols/user_process.rs.html#71-109">source</a></span><a href="#impl-Protocol-3" class="anchor"></a><h3 class="code-header in-band">impl&lt;A:&nbsp;<a class="trait" href="../protocols/user_process/trait.Application.html" title="trait elvis::protocols::user_process::Application">Application</a>&gt; <a class="trait" href="trait.Protocol.html" title="trait elvis::core::Protocol">Protocol</a> for <a class="struct" href="../protocols/user_process/struct.UserProcess.html" title="struct elvis::protocols::user_process::UserProcess">UserProcess</a>&lt;A&gt;</h3></section></div><script type="text/javascript" src="../../implementors/elvis/core/protocol/trait.Protocol.js" data-ignore-extern-crates="" async></script></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="elvis" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.62.1 (e092d0b6b 2022-07-16)" ></div>
</body></html>